<% @title = @item.title -%>
<% @nav = @item.nav -%>
<h1><%= @item.title -%></h1>
<% if admin? -%>
    <div>
      <%= button_to 'Edit', { :action => 'edit', :id => @item }, :method => :get %>
      <%= button_to 'Delete', { :action => 'delete', :id => @item }, :confirm => 'Are you sure?' %>
    </div>
<% end -%>
<div class="item_detail">
  <div class="item_detail_name"><%= t('item.price') -%></div>
  <div class="item_detail_content"><%= current_currency.format_yen_value(@item.price) -%></div>
</div>
<div class="item_detail">
  <div class="item_detail_name"><%= t('item.availability.title') -%></div>
  <div class="item_detail_content">
    <%= stock_display @item -%>
    <% if @item.max_order > 0 -%>
        <% form_tag :controller => 'cart', :action => 'add', :id => @item.id do %>
            <%= text_field :op, :quantity, :size => 3, :value => '1' %>
            <%= submit_tag t('item.add_to_cart') %>
        <% end -%>
    <% end -%>
  </div>
</div>
<div class="item_detail">
  <div class="item_detail_name"><%= t('item.description') -%></div>
  <div class="item_detail_content"><%= @item.description -%></div>
</div>
<div class="item_detail">
  <div class="item_detail_name"><%= t('item.author') -%></div>
  <div class="item_detail_content"><%= @item.author -%></div>
</div>
<div class="item_detail">
  <div class="item_detail_name"><%= t('item.type') -%></div>
  <div class="item_detail_content"><%= @item.item_type -%></div>
</div>
<div class="item_detail">
  <div class="item_detail_name"><%= t('item.pictures.title') -%></div>
  <div class="item_detail_content">
    <div id="gallery">
      <% @item.pictures.each do |p| -%>
          <a href="<%= static_url p.full_filename -%>"><%= image_tag static_url(p.thumb.full_filename), :alt => p.title, :width => p.thumb.width, :height => p.thumb.height -%></a>
      <% end -%>
    </div>
    <script type="text/javascript">
        $(function() {
            $('#gallery a').flyout({
                loadingText: "<%= t('item.pictures.loading') -%>",
                closeTip: "<%= t('item.pictures.close') -%>"
            });
        })
    </script>
  </div>
</div>
<% unless @item.video.nil? -%>
    <div class="item_detail">
      <div class="item_detail_name"><%= t('item.video') -%></div>
      <div class="item_detail_content">
        <a href="<%= static_url @item.video.full_filename -%>" style="display:block;width:<%= @item.video.width -%>px;height:<%= @item.video.height + 24 -%>px;z-index:0;background-color:black" id="player">
          <% if @item.video_preview -%>
              <img src="<%= static_url @item.video_preview.full_filename -%>" width="<%= @item.video.width -%>" height="<%= @item.video.height + 24 -%>" alt="<%= @item.video.title -%>"/>
          <% else -%>
              &nbsp;
          <% end -%>
        </a>
        <script type="text/javascript">
            $(function() {
                $('#player').flowplayer({
                    src: '<%= static_url '/swf/flowplayer.swf' -%>',
                    wmode: 'opaque'
                }, {
                    clip: {
                        scaling: 'fit',
                        bufferLength: 5
                    },
                });
            })
        </script>
      </div>
    </div>
<% end -%>
<% unless @item.publisher.nil? -%>
    <div class="item_detail">
      <div class="item_detail_name"><%= t('item.publisher') -%></div>
      <div class="item_detail_content"><%= @item.publisher -%></div>
    </div>
<% end -%>
<% unless @item.tracklist.nil? -%>
    <div class="item_detail">
      <div class="item_detail_name"><%= t('item.track_list') -%></div>
      <div class="item_detail_content">
        <div id="soundPlayer">&nbsp;</div>
        <div id="playlist">
          <ol>
            <% @item.tracklist.each_with_index do |track, i| -%>
                <li>
                  <span id="track_<%= i -%>_title"><%= track.title -%></span> [
                  <a href="javascript:void(0)" id="play_track_<%= i -%>" class="playLink">play</a> ]
                </li>
            <% end -%>
          </ol>
        </div>
        <script type="text/javascript">
            var tracks = [ <%= track_urls @item.tracklist -%> ];
            $(function() {
                $('#soundPlayer').jPlayer({
                    swfPath: '/swf'
                });
                $('.playLink').click(function() {
                    var value = $(this).html();
                    $('.playLink').each(function() {
                        $(this).html('play');
                    });
                    if (value == 'play') {
                        $(this).html('stop');
                        var selectedIndex = $(this).attr('id').substr(11);
                        $('#soundPlayer').setFile(tracks[selectedIndex]).play();
                    } else {
                        $('#soundPlayer').stop();
                    }
                });
            })
        </script>
      </div>
    </div>
<% end -%>
<% unless @item.test.nil? -%>
    <div class="item_detail">
      <div class="item_detail_name"><%= t('item.test') -%></div>
      <div class="item_detail_content"><%= @item.test -%></div>
    </div>
<% end -%>
<% unless @item.required_config.nil? -%>
    <div class="item_detail">
      <div class="item_detail_name"><%= t('item.required_conf') -%></div>
      <div class="item_detail_content"><%= @item.required_config -%></div>
    </div>
<% end -%>
<% unless @item.format.nil? -%>
    <div class="item_detail">
      <div class="item_detail_name"><%= t('item.format') -%></div>
      <div class="item_detail_content"><%= @item.format -%></div>
    </div>
<% end -%>
<% unless @item.warning.nil? -%>
    <div class="item_detail">
      <div class="item_detail_name"><%= t('item.warning') -%></div>
      <div class="item_detail_content"><%= @item.warning -%></div>
    </div>
<% end -%>
<% unless @item.notes.nil? -%>
    <div class="item_detail">
      <div class="item_detail_name"><%= t('item.notes') -%></div>
      <div class="item_detail_content"><%= @item.notes -%></div>
    </div>
<% end -%>
